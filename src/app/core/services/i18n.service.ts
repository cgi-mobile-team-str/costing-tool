import { computed, Injectable, signal } from '@angular/core';

export type Lang = 'fr' | 'en';

const FR = {
  // Common
  'common.save': 'Enregistrer',
  'common.cancel': 'Annuler',
  'common.delete': 'Supprimer',
  'common.edit': 'Éditer',
  'common.add': 'Ajouter',
  'common.all': 'Tous',
  'common.actions': 'Actions',
  'common.required': 'Requis',
  'common.confirm_delete': 'Êtes-vous sûr de vouloir supprimer cet élément ?',
  'common.total': 'Total',
  'common.selected': 'sélectionné(s)',
  'common.delete_selected': 'Supprimer la sélection',
  'common.confirm_bulk_delete': 'Supprimer ces éléments ?',
  'common.confirm_bulk_delete_with_count': 'Supprimer ces {count} élément(s) ?',
  'common.duplicate': 'Dupliquer',
  'common.yes': 'Oui',
  'common.no': 'Non',
  'common.ok': 'Ok',
  'common.close': 'Fermer',
  'common.clear_search': 'Réinitialiser la recherche',
  'common.move_up': 'Monter',
  'common.move_down': 'Descendre',
  'common.currency_per_day': '€/j',
  'common.name_placeholder': 'Ex. Nom',
  'common.new_title': 'Nouveau titre',
  'common.import': 'Importer',
  'common.history': 'Historique',

  // Navigation
  'nav.backlog': 'Backlog',
  'nav.profiles': 'Profils',
  'nav.settings': 'Paramètres',
  'nav.dashboard': 'Tableau de bord',
  'nav.planning': 'Planning',

  // Dashboard
  'dash.total_ht': 'Total HT',
  'dash.margin': 'Marge',
  'dash.total_ttc': 'Total (avec marge)',
  'dash.top_expensive': 'Top 5 Coûts',
  'dash.global': 'Global',
  'dash.ht_label': 'HT',
  'dash.cost_distribution': 'Répartition des coûts',
  'dash.profiles_stats': 'Coût et Charge par Profil',
  'dash.items': 'Items',
  'dash.charge': 'Charge (J)',
  'dash.scr_amount': 'Montant (SCR)',
  'dash.cost': 'Coût (HT)',
  'dash.no_data': 'Aucune donnée à afficher',

  // Profiles
  'profiles.name': 'Rôle',
  'profiles.username': 'Nom du collaborateur',
  'profiles.rate': 'TJM',
  'profiles.scr': 'SCR',
  'profiles.active': 'Actif',
  'profiles.create_title': 'Nouveau Profil',
  'profiles.edit_title': 'Éditer le profil',
  'profiles.edit_desc': 'Modifiez votre profil ici. Cliquez sur enregistrer une fois terminé.',
  'profiles.save_changes': 'Enregistrer les modifications',
  'profiles.name_exists': 'Ce nom existe déjà',
  'profiles.rate_positive': 'Doit être > 0',
  'profiles.global_margin': 'Marge Global (%)',
  'profiles.search_placeholder': 'Rechercher un profil...',
  'profiles.no_results': 'Aucun profil trouvé pour',
  'profiles.empty_title': 'Aucun profil pour ce projet',
  'profiles.empty_description':
    "Gagnez du temps en important les profils d'un autre projet ou ajoutez-les manuellement.",
  'profiles.import_from_project': "Importer d'un autre projet",
  'profiles.add_manually': 'Ajouter manuellement',
  'profiles.add_first': 'Ajouter mon premier profil',
  'profiles.import_title': 'Importer des profils',
  'profiles.import_desc': 'Sélectionnez un projet source pour copier ses profils.',
  'profiles.import_select_desc': 'Projets avec des profils disponibles :',
  'profiles.no_projects_to_import': 'Aucun autre projet avec des profils trouvé.',

  // Settings
  'settings.project_section': 'Projet',
  'settings.project_name': 'Nom du projet',
  'settings.project_start_date': 'Date de début du projet',
  'settings.calculations_section': 'Calculs',
  'settings.currency': 'Devise',
  'settings.interface_section': 'Interface',
  'settings.language': 'Langue',
  'settings.data_section': 'Gestion des données',
  'settings.data_hint':
    "Exportez votre backlog actuel ou importez un nouveau projet à partir d'un fichier JSON.",
  'settings.import_json': 'Importer un Backlog (JSON)',
  'settings.export_json': 'Exporter le Backlog (JSON)',
  'settings.danger_zone': 'Zone de danger',
  'settings.reset_app': 'Réinitialiser les données',
  'settings.delete_project': 'Supprimer le projet',
  'settings.confirm_delete_project':
    'Attention: Cela va supprimer définitivement le projet "{name}" ainsi que tous ses profils, produits, clusters et son backlog. Cette action est irréversible.',
  'settings.confirm_save_title': 'Confirmer la sauvegarde',
  'settings.confirm_save_desc': 'Voulez-vous vraiment enregistrer les modifications du projet ?',
  'settings.example': 'Ex:',

  // Backlog
  'backlog.title': 'Feature',
  'backlog.product': 'Produit',
  'backlog.cluster': 'Cluster',
  'backlog.scope': 'Périmètre',
  'backlog.moscow': 'MoSCoW',
  'backlog.effort': 'Charge',
  'backlog.profile': 'Profil',
  'backlog.cost': 'Coût',
  'backlog.create_title': 'Nouvel Item',
  'backlog.hypotheses': 'Hypothèses',
  'backlog.comments': 'Commentaires',
  'backlog.chargeType': 'Mode',
  'backlog.itemType': "Type d'élément",
  'backlog.type_build': 'Build',
  'backlog.type_other': 'Autre',
  'backlog.description': 'Description',
  'backlog.edit_title': "Modifier l'item",
  'backlog.create_desc': 'Ajoutez une nouvelle fonctionnalité au backlog.',
  'backlog.filter_profiles': 'Filtrer par profil',
  'backlog.filter_columns': 'Colonnes visibles',
  'backlog.delete_title': "Supprimer l'élément",
  'backlog.delete_confirm': 'Êtes-vous sûr de vouloir supprimer cet élément ?',
  'backlog.no_items': 'Aucun élément trouvé.',
  'backlog.cost_ht': '(HT)',
  'backlog.rtu': 'RTU',
  'backlog.ratio': 'Ratio',
  'backlog.scope_mvp': 'MVP',
  'backlog.scope_v1': 'V1',
  'backlog.scope_v2': 'V2',
  'backlog.moscow_must': 'Must',
  'backlog.moscow_should': 'Should',
  'backlog.moscow_could': 'Could',
  'backlog.moscow_wont': 'Wont',
  'backlog.percent': '(%)',
  'backlog.select_product_first_hint': 'Sélectionnez un produit en premier',
  'backlog.new_product_option': '➕ Nouveau produit',
  'backlog.new_cluster_option': '➕ Nouveau cluster',
  'backlog.new_product_placeholder': 'Ex. Produit ABC',
  'backlog.new_cluster_placeholder': 'Ex. Cluster ABC',
  'backlog.title_placeholder': 'Ex. Fonctionnalité ABC',
  'backlog.select_placeholder': 'Sélectionnez...',
  'backlog.modified': 'Modifié',
  'backlog.filter_history': 'Filtrer par historique',
  'backlog.history_title': 'Historique des modifications',
  'history.field': 'Champ',
  'history.before': 'Avant',
  'history.after': 'Après',
  'history.no_changes': 'Aucun changement détecté',
  'history.action_create': 'Création',
  'history.action_update': 'Modification',
  'history.action_delete': 'Suppression',
  'history.initial_author': 'Auteur initial',
  'history.subtitle': "Suivez l'évolution de cet élément au fil du temps",
  'history.no_data': 'Aucun historique',
  'history.no_history_yet_hint': "Cet élément n'a pas encore été modifié.",
  'history.filter_unmodified': 'Non modifiés',
  'history.filter_modified': 'Modifiés',
  'backlog.comments_title': 'Commentaires',
  'backlog.add_comment': 'Ajouter un commentaire',
  'backlog.comment_placeholder': 'Tapez votre commentaire ici...',
  'backlog.no_comments': 'Aucun commentaire pour cet élément.',
  'backlog.view_comments': 'Afficher les commentaires',

  // Management
  'management.title': 'Gérer les produits et clusters',
  'management.desc': 'Supprimer les produits ou clusters inutilisés',
  'management.products_clusters': 'Produits et Clusters',
  'management.delete_blocked': 'Suppression bloquée',
  'management.product_used_desc': 'Ce produit est utilisé et ne peut pas être supprimé.',
  'management.cluster_used_desc': 'Ce cluster est utilisé et ne peut pas être supprimé.',
  'management.delete_product': 'Supprimer le produit',
  'management.confirm_delete_product': 'Voulez-vous vraiment supprimer le produit {name} ?',
  'management.delete_cluster': 'Supprimer le cluster',
  'management.confirm_delete_cluster': 'Voulez-vous vraiment supprimer le cluster {name} ?',
  'management.empty_clusters': 'Aucun cluster défini',
  'management.empty_products': 'Aucun produit défini',
  'management.delete_product_title': 'Supprimer le produit',
  'management.delete_cluster_title': 'Supprimer le cluster',

  // Project Selection
  'project_sel.welcome_title': 'Bienvenue',
  'project_sel.welcome_desc':
    'Veuillez sélectionner le projet sur lequel vous souhaitez travailler pour continuer.',
  'project_sel.create_new': 'Créer un nouveau projet',
  'project_sel.create_btn': 'Créer',
  'project_sel.cancel_btn': 'Annuler',
  'project_sel.name_label': 'Nom du projet',
  'project_sel.placeholder': 'Ex: Mon Super Projet',
  'project_sel.no_projects': 'Aucun projet trouvé.',
  'project_sel.error_loading': 'Erreur lors du chargement des projets :',
  'project_sel.retry': 'Réessayer',
  'project_sel.created_at': 'Créé le',
  'project_sel.duplicate_title': 'Dupliquer le projet',
  'project_sel.duplicate_desc': 'Veuillez choisir un nom pour la copie de ce projet.',
  'project_sel.duplicate_name_label': 'Nom du nouveau projet',
  'project_sel.duplicate_placeholder': 'Ex: Mon Projet (Copie)',
  'project_sel.duplicate_btn': 'Dupliquer',
  'project_sel.creating': 'Création...',

  // Backlog Versioning
  'backlog.draft': 'Brouillon',
  'backlog.create_version_snapshot': 'Créer une version (Snapshot)',
  'backlog.enter_version_name': 'Entrez le nom de la version (ex: v1.0)',
  'backlog.version_created': 'Version créée avec succès',
  'backlog.version_exists': 'Une version avec ce nom existe déjà',

  // Filters
  'backlog.search_placeholder': 'Rechercher...',
  'backlog.scope_all': 'Tous les périmètres',
  'summary.by_profile': 'Récapitulatif par Profil',
  'summary.by_hierarchy': 'Récapitulatif par Produit et Cluster',
  'summary.by_hierarchy_scoped': 'Récapitulatif Produit/Cluster par Périmètre',
};

const EN = {
  // Common
  'common.save': 'Save',
  'common.cancel': 'Cancel',
  'common.delete': 'Delete',
  'common.edit': 'Edit',
  'common.add': 'Add',
  'common.all': 'All',
  'common.actions': 'Actions',
  'common.required': 'Required',
  'common.confirm_delete': 'Are you sure you want to delete this item?',
  'common.total': 'Total',
  'common.selected': 'selected',
  'common.delete_selected': 'Delete Selected',
  'common.confirm_bulk_delete': 'Delete these items?',
  'common.confirm_bulk_delete_with_count': 'Delete these {count} item(s)?',
  'common.duplicate': 'Duplicate',
  'common.yes': 'Yes',
  'common.no': 'No',
  'common.ok': 'Ok',
  'common.close': 'Close',
  'common.clear_search': 'Clear search',
  'common.move_up': 'Move up',
  'common.move_down': 'Move down',
  'common.currency_per_day': '€/d',
  'common.name_placeholder': 'Ex. Name',
  'common.new_title': 'New title',
  'common.import': 'Import',
  'common.history': 'History',

  // Navigation
  'nav.backlog': 'Backlog',
  'nav.profiles': 'Profiles',
  'nav.settings': 'Settings',
  'nav.dashboard': 'Dashboard',
  'nav.planning': 'Planning',

  // Dashboard
  'dash.total_ht': 'Total Excl. Tax',
  'dash.margin': 'Margin',
  'dash.total_ttc': 'Total (w/ Margin)',
  'dash.top_expensive': 'Top 5 Expensive',
  'dash.global': 'Global',
  'dash.ht_label': 'Excl. Tax',
  'dash.cost_distribution': 'Cost Distribution',
  'dash.profiles_stats': 'Cost & Workload per Profile',
  'dash.items': 'Items',
  'dash.charge': 'Workload (D)',
  'dash.scr_amount': 'Amount (SCR)',
  'dash.cost': 'Cost (Excl. Tax)',
  'dash.no_data': 'No data to display',

  // Profiles
  'profiles.name': 'Role',
  'profiles.username': 'Collaborator Name',
  'profiles.rate': 'Daily Rate',
  'profiles.scr': 'SCR',
  'profiles.active': 'Active',
  'profiles.create_title': 'New Profile',
  'profiles.edit_title': 'Edit profile',
  'profiles.edit_desc': "Make changes to your profile here. Click save when you're done.",
  'profiles.save_changes': 'Save changes',
  'profiles.name_exists': 'Name already exists',
  'profiles.rate_positive': 'Must be > 0',
  'profiles.global_margin': 'Global Margin (%)',
  'profiles.search_placeholder': 'Search profile...',
  'profiles.no_results': 'No profile found for',
  'profiles.empty_title': 'No profiles for this project',
  'profiles.empty_description':
    'Save time by importing profiles from another project or add them manually.',
  'profiles.import_from_project': 'Import from another project',
  'profiles.add_manually': 'Add manually',
  'profiles.add_first': 'Add my first profile',
  'profiles.import_title': 'Import profiles',
  'profiles.import_desc': 'Select a source project to copy its profiles.',
  'profiles.import_select_desc': 'Projects with available profiles:',
  'profiles.no_projects_to_import': 'No other projects with profiles found.',

  // Settings
  'settings.project_section': 'Project',
  'settings.project_name': 'Project Name',
  'settings.project_start_date': 'Project Start Date',
  'settings.calculations_section': 'Calculations',
  'settings.currency': 'Currency',
  'settings.interface_section': 'Interface',
  'settings.language': 'Language',
  'settings.data_section': 'Data Management',
  'settings.data_hint': 'Export your current backlog or import a new project from a JSON file.',
  'settings.import_json': 'Import Backlog (JSON)',
  'settings.export_json': 'Export Backlog (JSON)',
  'settings.danger_zone': 'Danger Zone',
  'settings.reset_app': 'Reset App Data',
  'settings.delete_project': 'Delete project',
  'settings.confirm_delete_project':
    'Warning: This will permanently delete project "{name}" along with all its profiles, products, clusters and backlog. This action is irreversible.',
  'settings.confirm_save_title': 'Confirm Save',
  'settings.confirm_save_desc': 'Are you sure you want to save project changes?',
  'settings.example': 'Ex:',

  // Backlog
  'backlog.title': 'Feature',
  'backlog.product': 'Product',
  'backlog.cluster': 'Cluster',
  'backlog.scope': 'Scope',
  'backlog.moscow': 'MoSCoW',
  'backlog.effort': 'Effort',
  'backlog.profile': 'Profile',
  'backlog.cost': 'Cost',
  'backlog.create_title': 'New Item',
  'backlog.hypotheses': 'Hypotheses',
  'backlog.comments': 'Comments',
  'backlog.chargeType': 'Mode',
  'backlog.itemType': 'Item Type',
  'backlog.type_build': 'Build',
  'backlog.type_other': 'Other',
  'backlog.description': 'Description',
  'backlog.edit_title': 'Edit Item',
  'backlog.create_desc': 'Add a new feature to the backlog.',
  'backlog.filter_profiles': 'Filter by profile',
  'backlog.filter_columns': 'Visible columns',
  'backlog.delete_title': 'Delete Item',
  'backlog.delete_confirm': 'Are you sure you want to delete this item?',
  'backlog.no_items': 'No items found.',
  'backlog.cost_ht': '(Excl. Tax)',
  'backlog.rtu': 'RTU',
  'backlog.ratio': 'Ratio',
  'backlog.scope_mvp': 'MVP',
  'backlog.scope_v1': 'V1',
  'backlog.scope_v2': 'V2',
  'backlog.moscow_must': 'Must',
  'backlog.moscow_should': 'Should',
  'backlog.moscow_could': 'Could',
  'backlog.moscow_wont': 'Wont',
  'backlog.percent': '(%)',
  'backlog.select_product_first_hint': 'Select a product first',
  'backlog.new_product_option': '➕ New product',
  'backlog.new_cluster_option': '➕ New cluster',
  'backlog.new_product_placeholder': 'Ex. Product ABC',
  'backlog.new_cluster_placeholder': 'Ex. Cluster ABC',
  'backlog.title_placeholder': 'Ex. Feature ABC',
  'backlog.select_placeholder': 'Select...',
  'backlog.modified': 'Modified',
  'backlog.filter_history': 'Filter by history',
  'backlog.history_title': 'Change History',
  'history.field': 'Field',
  'history.before': 'Before',
  'history.after': 'After',
  'history.no_changes': 'No changes detected',
  'history.action_create': 'Creation',
  'history.action_update': 'Update',
  'history.action_delete': 'Deletion',
  'history.initial_author': 'Original Author',
  'history.subtitle': 'Track the evolution of this item over time',
  'history.no_data': 'No history',
  'history.no_history_yet_hint': 'This item has not been modified yet.',
  'history.filter_unmodified': 'Unmodified',
  'history.filter_modified': 'Modified',
  'backlog.comments_title': 'Comments',
  'backlog.add_comment': 'Add a comment',
  'backlog.comment_placeholder': 'Type your comment here...',
  'backlog.no_comments': 'No comments for this item.',
  'backlog.view_comments': 'View comments',

  // Management
  'management.title': 'Manage products and clusters',
  'management.desc': 'Delete unused products or clusters',
  'management.products_clusters': 'Products and Clusters',
  'management.delete_blocked': 'Deletion blocked',
  'management.product_used_desc': 'This product is in use and cannot be deleted.',
  'management.cluster_used_desc': 'This cluster is in use and cannot be deleted.',
  'management.delete_product': 'Delete product',
  'management.confirm_delete_product': 'Are you sure you want to delete product {name}?',
  'management.delete_cluster': 'Delete cluster',
  'management.confirm_delete_cluster': 'Are you sure you want to delete cluster {name}?',
  'management.empty_clusters': 'No clusters defined',
  'management.empty_products': 'No products defined',
  'management.delete_product_title': 'Delete product',
  'management.delete_cluster_title': 'Delete cluster',

  // Project Selection
  'project_sel.welcome_title': 'Welcome',
  'project_sel.welcome_desc': 'Please select the project you want to work on to continue.',
  'project_sel.create_new': 'Create new project',
  'project_sel.create_btn': 'Create',
  'project_sel.cancel_btn': 'Cancel',
  'project_sel.name_label': 'Project Name',
  'project_sel.placeholder': 'Ex: My Super Project',
  'project_sel.no_projects': 'No projects found.',
  'project_sel.error_loading': 'Error loading projects:',
  'project_sel.retry': 'Retry',
  'project_sel.created_at': 'Created on',
  'project_sel.duplicate_title': 'Duplicate Project',
  'project_sel.duplicate_desc': 'Please choose a name for the copy of this project.',
  'project_sel.duplicate_name_label': 'New Project Name',
  'project_sel.duplicate_placeholder': 'Ex: My Project (Copy)',
  'project_sel.duplicate_btn': 'Duplicate',
  'project_sel.creating': 'Creating...',

  // Backlog Versioning
  'backlog.draft': 'Draft',
  'backlog.create_version_snapshot': 'Create Version Snapshot',
  'backlog.enter_version_name': 'Enter version name (e.g. v1.0)',
  'backlog.version_created': 'Version created successfully',
  'backlog.version_exists': 'A version with this name already exists',

  // Filters
  'backlog.search_placeholder': 'Search...',
  'backlog.scope_all': 'All Scopes',
  'summary.by_profile': 'Summary by Profile',
  'summary.by_hierarchy': 'Summary by Product and Cluster',
  'summary.by_hierarchy_scoped': 'Product/Cluster Summary by Scope',
};

@Injectable({
  providedIn: 'root',
})
export class I18nService {
  private currentLang = signal<Lang>('fr');

  readonly translations = computed(() => {
    return this.currentLang() === 'fr' ? FR : EN;
  });

  setLang(lang: Lang) {
    this.currentLang.set(lang);
  }

  getLang() {
    return this.currentLang();
  }

  translate(key: string): string {
    const t = this.translations() as any;
    return t[key] || key;
  }
}
